<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Double Pipe Heat Exchanger Design | Shreyas Thakur</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../../style.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <nav>
        <a href="../../index.html" class="logo">Shreyas</a>
        <div class="nav-links">
            <a href="../../index.html">Home</a>
            <a href="../../index.html#projects" class="active">Projects</a>
            <a href="../../contact.html">Comm Link</a>
        </div>
    </nav>

    <main class="project-container">
        <header class="project-header">
            <h1>Double Pipe Heat Exchanger Design</h1>
            <p>Advanced iterative design tool with standard pipe optimization.</p>
        </header>

        <div class="calc-grid">
            <!-- INPUTS -->
            <form id="designForm" class="input-panel card">

                <div class="input-group">
                    <h3><span class="icon">üî•</span> Hot Fluid</h3>
                    <div class="row">
                        <label>Select Fluid
                            <select id="hot_fluid_select" onchange="autoFillProps('hot', this.value)">
                                <option value="user_defined">User Defined</option>
                                <option value="water">Water</option>
                                <option value="air">Air</option>
                                <option value="engine_oil">Engine Oil</option>
                                <option value="kerosene">Kerosene</option>
                                <option value="benzene">Benzene</option>
                                <option value="ethanol">Ethanol</option>
                            </select>
                        </label>
                    </div>
                    <label>Mass Flow Rate (kg/s) <input type="number" step="any" name="m_h"
                            placeholder="Optional if temps known"></label>
                    <label>Inlet Temp (¬∞C) <input type="number" step="any" name="T_h_in" required></label>
                    <label>Outlet Temp (¬∞C) <input type="number" step="any" name="T_h_out"
                            placeholder="Optional if Cold Out is known"></label>
                    <label>Specific Heat (kJ/kg.K) <input type="number" step="any" name="Cp_h" id="h_cp"
                            required></label>
                    <label>Density (kg/m¬≥) <input type="number" step="any" name="rho_h" id="h_rho" required></label>
                    <label>Viscosity (Pa.s) <input type="number" step="any" name="mu_h" id="h_mu" required></label>
                    <label>Thermal Cond. (W/m.K) <input type="number" step="any" name="k_h" id="h_k" required></label>
                    <label>Fouling Factor <input type="number" step="any" name="Rf_h" value="0.0002"></label>
                </div>

                <div class="input-group">
                    <h3><span class="icon">‚ùÑÔ∏è</span> Cold Fluid</h3>
                    <div class="row">
                        <label>Select Fluid
                            <select id="cold_fluid_select" onchange="autoFillProps('cold', this.value)">
                                <option value="user_defined">User Defined</option>
                                <option value="water">Water</option>
                                <option value="air">Air</option>
                                <option value="engine_oil">Engine Oil</option>
                                <option value="kerosene">Kerosene</option>
                                <option value="benzene">Benzene</option>
                                <option value="ethanol">Ethanol</option>
                            </select>
                        </label>
                    </div>
                    <label>Mass Flow Rate (kg/s) <input type="number" step="any" name="m_c"
                            placeholder="Optional if temps known"></label>
                    <label>Inlet Temp (¬∞C) <input type="number" step="any" name="T_c_in" required></label>
                    <label>Outlet Temp (¬∞C) <input type="number" step="any" name="T_c_out"
                            placeholder="Optional if Hot Out is known"></label>
                    <label>Specific Heat (kJ/kg.K) <input type="number" step="any" name="Cp_c" id="c_cp"
                            required></label>
                    <label>Density (kg/m¬≥) <input type="number" step="any" name="rho_c" id="c_rho" required></label>
                    <label>Viscosity (Pa.s) <input type="number" step="any" name="mu_c" id="c_mu" required></label>
                    <label>Thermal Cond. (W/m.K) <input type="number" step="any" name="k_c" id="c_k" required></label>
                    <label>Fouling Factor <input type="number" step="any" name="Rf_c" value="0.0002"></label>
                </div>

                <div class="input-group full-width">
                    <h3><span class="icon">‚öôÔ∏è</span> Design Parameters</h3>
                    <div class="row">
                        <label>Flow Arrangement
                            <select name="flow_type">
                                <option value="1">Counter-Current</option>
                                <option value="2">Co-Current</option>
                            </select>
                        </label>
                        <label>Fluid Allocation
                            <select name="fluid_allocation">
                                <option value="hot_inner">Hot Fluid in Inner Pipe</option>
                                <option value="cold_inner">Cold Fluid in Inner Pipe</option>
                            </select>
                        </label>
                        <label>Max dP (Pa) <input type="number" step="any" name="allowable_dp_inner"
                                value="70000"></label>
                    </div>
                </div>

                <button type="submit" class="cta-button primary full-width">Optimize Design</button>
            </form>

            <!-- OUTPUTS -->
            <div class="output-panel">
                <div id="results" class="card result-card hidden">
                    <h3>Recommended Design</h3>

                    <div class="highlight-box">
                        <div class="rec-pipe">
                            <span>Inner Pipe</span>
                            <strong id="res-inner-pipe">-</strong>
                        </div>
                        <div class="rec-x">x</div>
                        <div class="rec-pipe">
                            <span>Outer Pipe</span>
                            <strong id="res-outer-pipe">-</strong>
                        </div>
                    </div>

                    <div class="result-grid">
                        <div class="result-item"><span>Heat Duty (Q)</span><strong id="res-Q">-</strong></div>
                        <div class="result-item"><span>Area Required</span><strong id="res-Area">-</strong></div>
                        <div class="result-item"><span>Length</span><strong id="res-Length">-</strong></div>
                        <div class="result-item"><span>LMTD</span><strong id="res-LMTD">-</strong></div>
                        <div class="result-item"><span>Overall U</span><strong id="res-U">-</strong></div>
                    </div>

                    <h4>Detailed Technical Report</h4>
                    <table class="tech-table">
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Inner Pipe</th>
                                <th>Annulus</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Fluid Identity</td>
                                <td id="rep-fluid-in">-</td>
                                <td id="rep-fluid-out">-</td>
                            </tr>
                            <tr>
                                <td>Flow Rate (kg/s)</td>
                                <td id="rep-mh">-</td>
                                <td id="rep-mc">-</td>
                            </tr>
                            <tr>
                                <td>Velocity (m/s)</td>
                                <td id="rep-v-in">-</td>
                                <td id="rep-v-out">-</td>
                            </tr>
                            <tr>
                                <td>Reynolds No.</td>
                                <td id="rep-re-in">-</td>
                                <td id="rep-re-out">-</td>
                            </tr>
                            <tr>
                                <td>Prandtl No.</td>
                                <td id="rep-pr-in">-</td> // Not strictly calc in display but implies
                                <td id="rep-pr-out">-</td>
                            </tr>
                            <tr>
                                <td>HTC (h) (W/m¬≤K)</td>
                                <td id="rep-h-in">-</td>
                                <td id="rep-h-out">-</td>
                            </tr>
                            <tr>
                                <td>Pressure Drop (Pa)</td>
                                <td id="rep-dp-in">-</td>
                                <td id="rep-dp-out">-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="card log-card">
                    <h3>Optimization Logs</h3>
                    <div id="logs" class="log-console">
                        <p class="placeholder">Waiting for calculation...</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="script.js"></script>
    <script>
        // Auto-Fill Logic
        function autoFillProps(side, fluid) {
            const props = FLUID_PROPERTIES[fluid];
            if (!props || fluid === 'user_defined') return;

            const map = {
                'hot': { rho: 'h_rho', mu: 'h_mu', cp: 'h_cp', k: 'h_k' },
                'cold': { rho: 'c_rho', mu: 'c_mu', cp: 'c_cp', k: 'c_k' }
            };

            document.getElementById(map[side].rho).value = props.rho;
            document.getElementById(map[side].mu).value = props.mu;
            document.getElementById(map[side].cp).value = props.cp;
            document.getElementById(map[side].k).value = props.k;
        }

        document.getElementById('designForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());

            const logContainer = document.getElementById('logs');
            logContainer.innerHTML = '';

            const result = calculateDPHX(data);

            const resCard = document.getElementById('results');
            resCard.classList.remove('hidden');

            if (result.error) {
                logContainer.innerHTML = `<p class="error">${result.error}</p>`;
                if (result.logs) {
                    result.logs.forEach(log => {
                        const p = document.createElement('p');
                        p.textContent = "> " + log;
                        logContainer.appendChild(p);
                    });
                }
                return;
            }

            const opt = result.opt;

            // Header
            document.getElementById('res-inner-pipe').textContent = opt.inner_pipe.name;
            document.getElementById('res-outer-pipe').textContent = opt.outer_pipe.name;

            // Summary
            document.getElementById('res-Q').textContent = (opt.Q / 1000).toFixed(2) + " kW";
            document.getElementById('res-Area').textContent = opt.A_req.toFixed(2) + " m¬≤";
            document.getElementById('res-Length').textContent = opt.L_req.toFixed(2) + " m";
            document.getElementById('res-LMTD').textContent = opt.LMTD.toFixed(2) + " ¬∞C";
            document.getElementById('res-U').textContent = opt.U.toFixed(1) + " W/m¬≤K";

            // Detailed Report
            if (opt.allocation === "hot_inner") {
                document.getElementById('rep-fluid-in').textContent = "Hot";
                document.getElementById('rep-fluid-out').textContent = "Cold";
            } else {
                document.getElementById('rep-fluid-in').textContent = "Cold";
                document.getElementById('rep-fluid-out').textContent = "Hot";
            }

            document.getElementById('rep-mh').textContent = opt.m_h.toFixed(3);
            document.getElementById('rep-mc').textContent = opt.m_c.toFixed(3);
            document.getElementById('rep-v-in').textContent = opt.v_in.toFixed(2);
            document.getElementById('rep-v-out').textContent = opt.v_ann.toFixed(2);
            document.getElementById('rep-re-in').textContent = opt.Re_in.toFixed(0);
            document.getElementById('rep-re-out').textContent = opt.Re_ann.toFixed(0);
            document.getElementById('rep-h-in').textContent = opt.h_in.toFixed(0);
            document.getElementById('rep-h-out').textContent = opt.h_ann.toFixed(0);
            document.getElementById('rep-dp-in').textContent = opt.dP_in.toFixed(0);
            document.getElementById('rep-dp-out').textContent = opt.dP_ann.toFixed(0);

            // Logs
            result.logs.forEach(log => {
                const p = document.createElement('p');
                p.textContent = "> " + log;
                logContainer.appendChild(p);
            });
        });
    </script>
</body>

</html>