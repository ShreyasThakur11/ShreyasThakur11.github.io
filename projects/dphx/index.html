<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Double Pipe Heat Exchanger Design | Shreyas Thakur</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../../style.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <nav>
        <a href="../../index.html" class="logo">Shreyas</a>
        <div class="nav-links">
            <a href="../../index.html">Home</a>
            <a href="../../index.html#projects" class="active">Projects</a>
            <a href="../../contact.html">Comm Link</a>
        </div>
    </nav>

    <main class="project-container">
        <header class="project-header">
            <h1>Double Pipe Heat Exchanger Design</h1>
            <p>Iterative design tool for calculating area, length, and pressure drops.</p>
        </header>

        <div class="calc-grid">
            <!-- INPUTS -->
            <form id="designForm" class="input-panel card">

                <div class="input-group">
                    <h3><span class="icon">üî•</span> Hot Fluid</h3>
                    <label>Mass Flow Rate (kg/s) <input type="number" step="any" name="m_h"
                            placeholder="Optional if temps known"></label>
                    <label>Inlet Temp (¬∞C) <input type="number" step="any" name="T_h_in" required></label>
                    <label>Outlet Temp (¬∞C) <input type="number" step="any" name="T_h_out"
                            placeholder="Optional if Cold Out is known"></label>
                    <label>Specific Heat (kJ/kg.K) <input type="number" step="any" name="Cp_h" required></label>
                    <label>Density (kg/m¬≥) <input type="number" step="any" name="rho_h" required></label>
                    <label>Viscosity (Pa.s) <input type="number" step="any" name="mu_h" required></label>
                    <label>Thermal Cond. (W/m.K) <input type="number" step="any" name="k_h" required></label>
                    <label>Fouling Factor <input type="number" step="any" name="Rf_h" value="0.0002"></label>
                </div>

                <div class="input-group">
                    <h3><span class="icon">‚ùÑÔ∏è</span> Cold Fluid</h3>
                    <label>Mass Flow Rate (kg/s) <input type="number" step="any" name="m_c"
                            placeholder="Optional if temps known"></label>
                    <label>Inlet Temp (¬∞C) <input type="number" step="any" name="T_c_in" required></label>
                    <label>Outlet Temp (¬∞C) <input type="number" step="any" name="T_c_out"
                            placeholder="Optional if Hot Out is known"></label>
                    <label>Specific Heat (kJ/kg.K) <input type="number" step="any" name="Cp_c" required></label>
                    <label>Density (kg/m¬≥) <input type="number" step="any" name="rho_c" required></label>
                    <label>Viscosity (Pa.s) <input type="number" step="any" name="mu_c" required></label>
                    <label>Thermal Cond. (W/m.K) <input type="number" step="any" name="k_c" required></label>
                    <label>Fouling Factor <input type="number" step="any" name="Rf_c" value="0.0002"></label>
                </div>

                <div class="input-group full-width">
                    <h3><span class="icon">‚öôÔ∏è</span> Design Parameters</h3>
                    <div class="row">
                        <label>Assumed U (W/m¬≤.K) <input type="number" step="any" name="U_assumed" value="300"
                                required></label>
                        <label>Flow Arrangement
                            <select name="flow_type">
                                <option value="1">Counter-Current</option>
                                <option value="2">Co-Current</option>
                            </select>
                        </label>
                    </div>
                    <div class="row">
                        <label>Outer Pipe DO (m) <input type="number" step="any" name="D_o" value="0.05"
                                required></label>
                        <label>Inner Pipe Size
                            <select name="pipe_size_idx">
                                <option value="1">19 mm OD</option>
                                <option value="2" selected>25 mm OD</option>
                                <option value="3">32 mm OD</option>
                                <option value="4">38 mm OD</option>
                            </select>
                        </label>
                    </div>
                    <div class="row">
                        <label>Max dP Inner (Pa) <input type="number" step="any" name="allowable_dp_inner"
                                value="70000"></label>
                        <label>Max dP Annulus (Pa) <input type="number" step="any" name="allowable_dp_ann"
                                value="70000"></label>
                    </div>
                </div>

                <button type="submit" class="cta-button primary full-width">Calculate Design</button>
            </form>

            <!-- OUTPUTS -->
            <div class="output-panel">
                <div id="results" class="card result-card hidden">
                    <h3>Results Summary</h3>
                    <div class="result-grid">
                        <div class="result-item">
                            <span>Heat Duty (Q)</span>
                            <strong id="res-Q">-</strong>
                        </div>
                        <div class="result-item">
                            <span>Mass Flow (Hot)</span>
                            <strong id="res-mh">-</strong>
                        </div>
                        <div class="result-item">
                            <span>Mass Flow (Cold)</span>
                            <strong id="res-mc">-</strong>
                        </div>
                        <div class="result-item">
                            <span>Area Required</span>
                            <strong id="res-Area">-</strong>
                        </div>
                        <div class="result-item">
                            <span>Length Required</span>
                            <strong id="res-Length">-</strong>
                        </div>
                        <div class="result-item">
                            <span>LMTD</span>
                            <strong id="res-LMTD">-</strong>
                        </div>
                        <div class="result-item">
                            <span>Final U</span>
                            <strong id="res-U">-</strong>
                        </div>
                        <div class="result-item">
                            <span>Inner dP</span>
                            <strong id="res-dP-in">-</strong>
                        </div>
                        <div class="result-item">
                            <span>Annulus dP</span>
                            <strong id="res-dP-out">-</strong>
                        </div>
                    </div>

                    <div class="status-badges">
                        <span id="u-status" class="badge">Checking U...</span>
                        <span id="dp-status" class="badge">Checking dP...</span>
                    </div>
                </div>

                <div class="card log-card">
                    <h3>Iteration Logs</h3>
                    <div id="logs" class="log-console">
                        <p class="placeholder">Waiting for calculation...</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="script.js"></script>
    <script>
        document.getElementById('designForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());

            // Clear previous logs
            const logContainer = document.getElementById('logs');
            logContainer.innerHTML = '';

            // Run Calculation
            const result = calculateDPHX(data);

            // Show Results
            const resCard = document.getElementById('results');
            resCard.classList.remove('hidden');

            if (result.error) {
                logContainer.innerHTML = `<p class="error">${result.error}</p>`;
                return;
            }

            // Populate Results
            document.getElementById('res-Q').textContent = (result.Q / 1000).toFixed(2) + " kW";
            document.getElementById('res-mh').textContent = result.m_h_calc.toFixed(3) + " kg/s";
            document.getElementById('res-mc').textContent = result.m_c_calc.toFixed(3) + " kg/s";
            document.getElementById('res-Area').textContent = result.A_required.toFixed(2) + " m¬≤";
            document.getElementById('res-Length').textContent = result.L_required.toFixed(2) + " m";
            document.getElementById('res-LMTD').textContent = result.LMTD.toFixed(2) + " ¬∞C";
            document.getElementById('res-U').textContent = result.U_calculated.toFixed(1) + " W/m¬≤.K";
            document.getElementById('res-dP-in').textContent = result.deltaP_inner.toFixed(0) + " Pa";
            document.getElementById('res-dP-out').textContent = result.deltaP_annulus.toFixed(0) + " Pa";

            // Status Badges
            const uBadge = document.getElementById('u-status');
            uBadge.textContent = result.U_valid ? "U Converged ‚úÖ" : "U Failed ‚ùå";
            uBadge.className = result.U_valid ? "badge success" : "badge error";

            const dpBadge = document.getElementById('dp-status');
            dpBadge.textContent = result.dp_valid ? "Pressure Drop OK ‚úÖ" : "Pressure Drop High ‚ö†Ô∏è";
            dpBadge.className = result.dp_valid ? "badge success" : "badge warning";

            // Logs
            result.logs.forEach(log => {
                const p = document.createElement('p');
                p.textContent = "> " + log;
                logContainer.appendChild(p);
            });
        });
    </script>
</body>

</html>