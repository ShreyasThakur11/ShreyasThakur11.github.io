<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shell & Tube Heat Exchanger Design | Shreyas Thakur</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../../style.css">
    <link rel="stylesheet" href="../dphx/style.css"> <!-- Reusing DPHX styles for consistency -->
</head>

<body>
    <nav>
        <a href="../../index.html" class="logo">Shreyas</a>
        <div class="nav-links">
            <a href="../../index.html">Home</a>
            <a href="../../index.html#projects" class="active">Projects</a>
            <a href="../../contact.html">Comm Link</a>
        </div>
    </nav>

    <main class="project-container">
        <header class="project-header">
            <!-- Breadcrumbs / Back Link -->
            <div style="margin-bottom: 1rem; font-size: 0.9rem;">
                <a href="../dphx/index.html" style="color: var(--secondary-color); text-decoration: none;">&larr; Switch
                    to Double Pipe</a>
            </div>
            <h1>Shell & Tube Heat Exchanger Design</h1>
            <p>Rigorous design using the Kern Method.</p>
        </header>

        <div class="calc-grid">
            <!-- INPUTS -->
            <form id="designForm" class="input-panel card">

                <!-- Fluid Allocation -->
                <div class="input-group full-width">
                    <h3><span class="icon">üîÑ</span> Configuration</h3>
                    <div class="row">
                        <label style="flex:2;">Fluid Allocation
                            <select name="fluid_allocation">
                                <option value="hot_shell">Hot Fluid in Shell / Cold in Tubes</option>
                                <option value="cold_shell">Cold Fluid in Shell / Hot in Tubes</option>
                            </select>
                        </label>
                    </div>
                </div>

                <!-- FLUIDS (Side by Side) -->
                <div class="row" style="gap: 2rem;">
                    <!-- HOT FLUID -->
                    <div class="input-group" style="flex:1;">
                        <h3><span class="icon">üî•</span> Hot Fluid</h3>
                        <label>Select Fluid <select id="hot_fluid_select" onchange="autoFillProps('hot', this.value)">
                                <option value="user_defined">User Defined</option>
                                <option value="water">Water</option>
                                <option value="air">Air</option>
                                <option value="engine_oil">Engine Oil</option>
                                <option value="kerosene">Kerosene</option>
                                <option value="benzene">Benzene</option>
                                <option value="ethanol">Ethanol</option>
                            </select></label>
                        <label>Mass Flow (kg/s) <input type="number" step="any" name="m_h"
                                placeholder="Opt. if temps known"></label>
                        <label>Inlet Temp (¬∞C) <input type="number" step="any" name="T_h_in" required></label>
                        <label>Outlet Temp (¬∞C) <input type="number" step="any" name="T_h_out"
                                placeholder="Opt. if Cold Out known"></label>
                        <label>Cp (kJ/kg.K) <input type="number" step="any" name="Cp_h" id="h_cp" required></label>
                        <label>Density (kg/m¬≥) <input type="number" step="any" name="rho_h" id="h_rho" required></label>
                        <label>Viscosity (Pa.s) <input type="number" step="any" name="mu_h" id="h_mu" required></label>
                        <label>Thermal Cond. (W/m.K) <input type="number" step="any" name="k_h" id="h_k"
                                required></label>
                        <label>Fouling Factor <input type="number" step="any" name="Rf_h" value="0.0002"></label>
                    </div>

                    <!-- COLD FLUID -->
                    <div class="input-group" style="flex:1;">
                        <h3><span class="icon">‚ùÑÔ∏è</span> Cold Fluid</h3>
                        <label>Select Fluid <select id="cold_fluid_select" onchange="autoFillProps('cold', this.value)">
                                <option value="user_defined">User Defined</option>
                                <option value="water">Water</option>
                                <option value="air">Air</option>
                                <option value="engine_oil">Engine Oil</option>
                                <option value="kerosene">Kerosene</option>
                                <option value="benzene">Benzene</option>
                                <option value="ethanol">Ethanol</option>
                            </select></label>
                        <label>Mass Flow (kg/s) <input type="number" step="any" name="m_c"
                                placeholder="Opt. if temps known"></label>
                        <label>Inlet Temp (¬∞C) <input type="number" step="any" name="T_c_in" required></label>
                        <label>Outlet Temp (¬∞C) <input type="number" step="any" name="T_c_out"
                                placeholder="Opt. if Hot Out known"></label>
                        <label>Cp (kJ/kg.K) <input type="number" step="any" name="Cp_c" id="c_cp" required></label>
                        <label>Density (kg/m¬≥) <input type="number" step="any" name="rho_c" id="c_rho" required></label>
                        <label>Viscosity (Pa.s) <input type="number" step="any" name="mu_c" id="c_mu" required></label>
                        <label>Thermal Cond. (W/m.K) <input type="number" step="any" name="k_c" id="c_k"
                                required></label>
                        <label>Fouling Factor <input type="number" step="any" name="Rf_c" value="0.0002"></label>
                    </div>
                </div>

                <!-- GEOMETRY -->
                <div class="input-group full-width">
                    <h3><span class="icon">üìê</span> Exchanger Geometry</h3>

                    <div class="row">
                        <div style="flex:1;">
                            <h4 style="color:var(--secondary-color); font-size:0.9rem; margin-bottom:0.5rem;">Shell Side
                            </h4>
                            <label>Shell Diameter (m) <input type="number" step="any" name="shell_ID" value="0.5"
                                    required></label>
                            <label>Baffle Spacing (m) <input type="number" step="any" name="baffle_spacing" value="0.25"
                                    required></label>
                            <label>Num Baffles <input type="number" step="any" name="baffles_n" value="10"
                                    required></label>
                        </div>
                        <div style="flex:1;">
                            <h4 style="color:var(--secondary-color); font-size:0.9rem; margin-bottom:0.5rem;">Tube Side
                            </h4>
                            <label>Total Tubes <input type="number" step="any" name="total_tubes" value="100"
                                    required></label>
                            <label>Tube Length (m) <input type="number" step="any" name="tube_length" value="3.0"
                                    required></label>
                            <label>Tube Passes <input type="number" step="any" name="tube_passes" value="2"
                                    required></label>
                            <label>Standard Tube Size
                                <select name="tube_od_select" id="tube_select" onchange="updateTubeDims()">
                                    <option value="0">19 mm (3/4")</option>
                                    <option value="1">25 mm (1")</option>
                                    <option value="2">32 mm (1.25")</option>
                                    <option value="3">38 mm (1.5")</option>
                                </select>
                            </label>
                            <input type="hidden" name="tube_od" id="tube_od" value="0.019">
                            <input type="hidden" name="tube_id" id="tube_id" value="0.016">

                            <label>Tube Pitch (m) <input type="number" step="any" name="tube_pitch" value="0.0238"
                                    required></label>
                            <label>Pitch Type
                                <select name="pitch_type">
                                    <option value="triangular">Triangular (30¬∞)</option>
                                    <option value="square">Square (90¬∞)</option>
                                </select>
                            </label>
                        </div>
                    </div>
                </div>

                <button type="submit" class="cta-button primary full-width">Calculate Rating</button>
            </form>

            <!-- OUTPUTS -->
            <div class="output-panel">
                <div id="results" class="card result-card hidden">
                    <h3>Design Rating</h3>

                    <div class="highlight-box">
                        <div class="rec-pipe">
                            <span>Area Provided</span>
                            <strong id="res-A-prov">-</strong>
                        </div>
                        <div class="rec-x" style="font-size:2rem;">vs</div>
                        <div class="rec-pipe">
                            <span>Area Required</span>
                            <strong id="res-A-req">-</strong>
                        </div>
                    </div>

                    <div style="text-align:center; margin-bottom:1.5rem;">
                        <span id="overdesign-badge" class="badge">Calculating...</span>
                    </div>

                    <div class="result-grid">
                        <div class="result-item"><span>Heat Duty (Q)</span><strong id="res-Q">-</strong></div>
                        <div class="result-item"><span>LMTD</span><strong id="res-LMTD">-</strong></div>
                        <div class="result-item"><span>U Clean</span><strong id="res-Uc">-</strong></div>
                        <div class="result-item"><span>U Design</span><strong id="res-Ud">-</strong></div>
                    </div>

                    <h4>Detailed Analysis</h4>
                    <table class="tech-table">
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Shell Side</th>
                                <th>Tube Side</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Fluid</td>
                                <td id="res-fl-shell">-</td>
                                <td id="res-fl-tube">-</td>
                            </tr>
                            <tr>
                                <td>Flow (kg/s)</td>
                                <td id="res-m-shell">-</td>
                                <td id="res-m-tube">-</td>
                            </tr>
                            <tr>
                                <td>Velocity (m/s)</td>
                                <td id="res-v-shell">-</td>
                                <td id="res-v-tube">-</td>
                            </tr>
                            <tr>
                                <td>Reynolds No.</td>
                                <td id="res-re-shell">-</td>
                                <td id="res-re-tube">-</td>
                            </tr>
                            <tr>
                                <td>HTC (h) (W/m¬≤K)</td>
                                <td id="res-h-shell">-</td>
                                <td id="res-h-tube">-</td>
                            </tr>
                            <tr>
                                <td>Pressure Drop</td>
                                <td id="res-dp-shell">-</td>
                                <td id="res-dp-tube">-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="card log-card">
                    <h3>Status</h3>
                    <div id="logs" class="log-console">
                        <p class="placeholder">Ready to calculate...</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="script.js"></script>
    <script>
        // Update hidden inputs for tube dims
        const TUBES = [
            { od: 0.019, id: 0.016 },
            { od: 0.025, id: 0.021 },
            { od: 0.032, id: 0.028 },
            { od: 0.038, id: 0.033 }
        ];
        function updateTubeDims() {
            const idx = document.getElementById('tube_select').value;
            const t = TUBES[idx];
            document.getElementById('tube_od').value = t.od;
            document.getElementById('tube_id').value = t.id;
        }

        // Reuse Auto-Fill from DPHX logic
        function autoFillProps(side, fluid) {
            const props = FLUID_PROPERTIES[fluid];
            if (!props || fluid === 'user_defined') return;
            const map = {
                'hot': { rho: 'h_rho', mu: 'h_mu', cp: 'h_cp', k: 'h_k' },
                'cold': { rho: 'c_rho', mu: 'c_mu', cp: 'c_cp', k: 'c_k' }
            };
            document.getElementById(map[side].rho).value = props.rho;
            document.getElementById(map[side].mu).value = props.mu;
            document.getElementById(map[side].cp).value = props.cp;
            document.getElementById(map[side].k).value = props.k;
        }

        document.getElementById('designForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());

            const result = calculateSTHX(data);
            const logContainer = document.getElementById('logs');
            logContainer.innerHTML = '';

            const resCard = document.getElementById('results');
            resCard.classList.remove('hidden');

            if (result.error) {
                logContainer.innerHTML = `<p class="error">${result.error}</p>`;
                return;
            } else {
                logContainer.innerHTML = `<p style="color:#10b981;">Calculation Successful!</p>`;
            }

            // High Level
            document.getElementById('res-A-prov').textContent = result.A_prov.toFixed(2) + " m¬≤";
            document.getElementById('res-A-req').textContent = result.A_req.toFixed(2) + " m¬≤";

            const badge = document.getElementById('overdesign-badge');
            if (result.overdesign >= 0) {
                badge.textContent = `Overdesign: +${result.overdesign.toFixed(1)}% (SAFE)`;
                badge.className = "badge success";
            } else {
                badge.textContent = `Overdesign: ${result.overdesign.toFixed(1)}% (UNDERSIZED)`;
                badge.className = "badge error";
            }

            document.getElementById('res-Q').textContent = (result.Q / 1000).toFixed(2) + " kW";
            document.getElementById('res-LMTD').textContent = result.LMTD.toFixed(2) + " ¬∞C";
            document.getElementById('res-Uc').textContent = result.U_clean.toFixed(1) + " W/m¬≤K";
            document.getElementById('res-Ud').textContent = result.U_design.toFixed(1) + " W/m¬≤K";

            // Detailed
            if (result.allocation == 'hot_shell') {
                document.getElementById('res-fl-shell').textContent = "Hot";
                document.getElementById('res-fl-tube').textContent = "Cold";
            } else {
                document.getElementById('res-fl-shell').textContent = "Cold";
                document.getElementById('res-fl-tube').textContent = "Hot";
            }

            // Shell Data
            document.getElementById('res-m-shell').textContent = (result.allocation == 'hot_shell' ? result.m_h : result.m_c).toFixed(3);
            document.getElementById('res-v-shell').textContent = result.v_s.toFixed(2);
            document.getElementById('res-re-shell').textContent = result.Re_s.toFixed(0);
            document.getElementById('res-h-shell').textContent = result.h_s.toFixed(1);
            document.getElementById('res-dp-shell').textContent = (result.dP_s / 1000).toFixed(1) + " kPa";

            // Tube Data
            document.getElementById('res-m-tube').textContent = (result.allocation == 'hot_shell' ? result.m_c : result.m_h).toFixed(3);
            document.getElementById('res-v-tube').textContent = result.v_t.toFixed(2);
            document.getElementById('res-re-tube').textContent = result.Re_t.toFixed(0);
            document.getElementById('res-h-tube').textContent = result.h_t.toFixed(1);
            document.getElementById('res-dp-tube').textContent = (result.dP_t / 1000).toFixed(1) + " kPa";

        });
    </script>
</body>

</html>